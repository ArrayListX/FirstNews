riot.tag("loginBox",'<div if="{options.tabs.length>0}" class="y-box login-header"> <div each="{item, i in options.tabs}" onmouseover="{mouseOver}" class="y-left item {active: options.activeType === i}"> <span>{item.name}</span> </div> </div> <div class="login-type">  <div if="{options.activeType == 1}" riot-tag="baseLogin" service="{opts.service}" captcha="{opts.captcha}" hidesns="{opts.hidesns}"></div> </div>','class="loginBox"',function(){this.options={tabs:[],activeType:1},this.mouseOver=function(o){this.options.activeType=o.item.i}.bind(this)}),riot.tag("baseLogin",'<div class="baseLogin"> <div if="{options.errorMsg}" class="error-msg"> <i class="y-icon icon-errormessage"></i> {options.errorMsg} <i onclick="{onErrorMsgClick}" class="y-right y-icon icon-clearicon"></i> </div> <form action="/auth/login/" method="POST" onsubmit="{onFormSubmit}"> <div if="{options.mode==1}" class="input-field"> <input id="mobile" type="text" name="mobile" autocomplete="off" spellcheck="false" placeholder="手机号"> </div> <div if="{options.mode==1&&options.captcha}" class="input-field verification"> <input id="captcha1" type="text" name="captcha1" autocomplete="off" spellcheck="false" placeholder="验证码"> <div class="captcha-wrap"> <img class="y-right captcha" riot-src="data:image/gif;base64,{options.captcha}" alt="" onclick="{refreshCaptcha}"> <span class="tips-bubble">看不清楚？换一张</span> </div> </div> <div if="{options.mode==1}" class="input-field phone-code"> <input id="code" type="text" name="code" autocomplete="off" spellcheck="false" placeholder="手机验证码"> <span class="code-btn {active: options.isCodeSending}" onclick="{getCodeClick}">{options.codeStatus}</span> </div> <div if="{options.mode==2}" class="input-field"> <input id="account" type="text" name="account" autocomplete="off" spellcheck="false" placeholder="邮箱/手机号"> </div> <div if="{options.mode==2}" class="input-field"> <input id="password" type="password" name="password" autocomplete="off" spellcheck="false" placeholder="密码"> </div> <div if="{options.mode==2&&options.captcha}" class="input-field verification"> <input id="captcha" type="text" name="captcha" autocomplete="off" spellcheck="false" placeholder="验证码"> <div class="captcha-wrap"> <img class="y-right captcha" riot-src="data:image/gif;base64,{options.captcha}" alt="" onclick="{refreshCaptcha}"> <span class="tips-bubble">看不清楚？换一张</span> </div> </div> <div class="y-box action">  <input id="agreement" class="agreement" type="checkbox" name="agreement" checked="checked"> <label for="agreement">我已阅读并同意<a href="https://www.toutiao.com/user_agreement/" target="_blank">用户协议</a>和<a href="https://www.toutiao.com/privacy_protection/" target="_blank">隐私条款</a></label> <a if="{options.source==1&&options.mode==2}" class="forget" href="http://mp.toutiao.com/forget/" target="_blank">忘记密码</a> <a if="{options.source==0&&options.mode==2}" class="forget" href="https://sso.toutiao.com/forget_password/?service={options.encodeService}" target="_blank">忘记密码</a> </div> <input type="submit" name="submitBtn" class="action-btn" value="登录"> </form> <ul if="{!options.hidesns}" class="sns-login" onclick="{snsLoginClick}"> <li class="sns {phone-login: options.mode==2} {mail-login: options.mode==1}" data-pid="mail_phone"> <span>{options.snsName}</span> </li> <li class="sns qq-login" data-pid="qzone_sns"> <span>QQ</span> </li> <li class="sns weixin-login" data-pid="weixin"> <span>微信</span> </li> </ul> </div>',function(o){function t(){for(var o=location.search.slice(1),t={},i=o.split("&"),e=0,s=i.length;s>e;e++){var a,n=i[e];""!==n.replace(/^\s+|\s+$/g,"")&&(a=n.split("="),t[a[0]]=a[1])}return t}function i(o){var t="https://www.toutiao.com/auth/connect/?type=sso";t+="&platform="+o,t+="&next=https://sso.toutiao.com/auth/login_success/?service="+l,window.location.href=t}function e(){if(1==n.options.mode){if(""==n.mobile.value.trim()||""==n.code.value.trim())return!1;if(n.options.captcha&&""==n.captcha1.value.trim())return!1}if(2==n.options.mode){if(""==n.account.value.trim()||""==n.password.value.trim())return!1;if(n.options.captcha&&""==n.captcha.value.trim())return!1}return!0}function s(){var o,t=60;o=setInterval(function(){return 0===t?(clearInterval(o),o=null,n.options.isCodeSending=!1,n.options.codeStatus="获取验证码",void n.update()):(n.options.codeStatus=t+"s重新获取",t--,void n.update())},1e3)}function a(){var o="";o=1==n.options.mode?n.captcha1&&n.captcha1.value:n.captcha&&n.captcha.value;var t={mobile:n.mobile&&n.mobile.value,code:n.code&&n.code.value,account:n.account&&n.account.value,password:n.password&&n.password.value,captcha:o,is_30_days_no_login:!1,service:l};return t}var n=(t(),this),c="/quick_login/",r="/refresh_captcha/",p=!1,l=o.service,d={0:"您输入的手机号或验证码不匹配",1:"您输入的账号或密码不匹配",2:"您输入的信息不完整",3:"验证码获取失败",4:"为了您的帐户安全，请输入图片验证码",5:"请输入正确的图片验证码",6:"需要阅读并同意用户协议和隐私条款",7:"为保证安全，请使用手机验证码登录"};this.options={source:0,snsName:"账号",mode:1,captcha:o.captcha||"",errorMsg:"",isCodeSending:!1,codeStatus:"获取验证码",encodeService:encodeURIComponent(l),hidesns:o.hidesns||!1},this.on("mount",function(){if(!this.options.hidesns){l.indexOf("mp.toutiao.com")>-1&&(this.options.source=1,this.options.snsName="手机",this.options.mode="2",c="/account_login/"),this.update(),this.refreshCaptcha();var o=/www.toutiao.com/g,t=o.test(document.referrer);t&&window.taAnalysis&&taAnalysis.send("event",{ev:"sso_from_pc"})}}),this.onFormSubmit=function(o){return o.preventDefault(),window.taAnalysis&&taAnalysis.send("event",{ev:"sso_login_click"}),e()?n.agreement.checked?void(p||(p=!0,this.submitBtn.value="登录中...",http({url:c,method:"POST",data:a(),headers:{"X-CSRFToken":Cookies.get("csrftoken")},success:function(o){0==o.error_code?(window.taAnalysis&&taAnalysis.send("event",{ev:"sso_login_success"}),window.location.href=o.redirect_url||l):(n.options.captcha=o.captcha||"",n.options.errorMsg=1==n.options.mode?d[0]:d[1],n.options.captcha&&(n.options.errorMsg=d[4]),1102==o.error_code&&(n.options.errorMsg=d[5]),1039==o.error_code&&(n.options.errorMsg=d[7],n.options.mode=1,n.options.snsName="账号",c="/quick_login/")),p=!1,n.submitBtn.value="登录",n.update()},error:function(){n.submitBtn.value="登录"}}))):(this.options.errorMsg=d[6],!1):void(this.options.errorMsg=d[2])}.bind(this),this.getCodeClick=function(){return this.options.isCodeSending?void 0:""==n.mobile.value.trim()?void(this.options.errorMsg=d[2]):void http({url:"/send_activation_code/",data:{mobile:n.mobile&&n.mobile.value,captcha:n.captcha1&&n.captcha1.value,type:24},method:"get",success:function(o){0===o.error_code?(n.options.isCodeSending=!0,s()):(n.options.captcha=o.captcha||"",n.options.errorMsg=d[3],n.options.captcha&&(n.options.errorMsg=d[4]),1102==o.error_code&&(n.options.errorMsg=d[5]),1003==o.error_code&&(n.options.errorMsg=o.description||"请求失败")),n.update()}})}.bind(this),this.snsLoginClick=function(o){var t,e=utils.getTarget(o);"li"==e.tagName.toLowerCase()&&(t=utils.getAttribute(e,"data-pid"),"mail_phone"==t?(this.options.mode=1==this.options.mode?2:1,this.options.snsName=1==this.options.mode?"账号":"手机",c=1==this.options.mode?"/quick_login/":"/account_login/"):i(t))}.bind(this),this.onErrorMsgClick=function(){this.options.errorMsg=""}.bind(this),this.refreshCaptcha=function(){http({url:r,method:"get",success:function(o){o.captcha?n.options.captcha=o.captcha:n.options.errorMsg=d[4],n.update()}})}.bind(this)});